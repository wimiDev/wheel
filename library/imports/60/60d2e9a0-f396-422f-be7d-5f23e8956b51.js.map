{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\game.js"],"names":["cc","Class","extends","Component","properties","circle","default","type","Node","itemTemplate","broadcast","coinLable","curRotate","setp","curSpeed","timer1","mysScheduler","listScript","msgList","coinPay","onLoad","log","storage","getComponent","start","init","myCoin","getMyCoin","updateCoin","broadcastNode","find","node","broadcastScript","recarbg","hisLsFSto","getAllHis","length","i","addNewRec","time","item","val","Label","string","setMyCoin","addCoin","addVal","cutCoin","cutVal","circleRun","speed","cirecleNode","stopAllActions","rotate","rotateBy","callback","callFunc","updateRotate","seq","sequence","runAction","repeatForever","createItem","tilp","num","id","instantiate","x","y","updateItem","pushToList","cirecleStopToSetp","are","rotation","Math","abs","resetTimer1","itemStr","getCurTime","_youGetNum","addAHis","bIndex","random","tilpList","baradcastMsg","target","data","startRandom","startTimer1","unschedule","sch1s","schedule","dt","update","begin","end","floor"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        circle:{\n            default:null,\n            type:cc.Node,\n        },\n        itemTemplate:{\n            default:null,\n            type:cc.Node, \n        },\n        broadcast:{\n            default:null,\n            type:cc.Node,\n        },\n        coinLable:{\n            default:null,\n            type:cc.Node,\n        },\n        curRotate: 0,\n        setp: 51.4,\n        curSpeed: 0,\n        timer1 : 0,\n        mysScheduler : null,\n        listScript : null,\n        msgList : null,\n        coinPay: 4,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n     onLoad () {\n        cc.log(\"--------- game start -----------\");\n\n        this.storage = this.getComponent(\"gameStorage\");\n    },\n    start () {\n        this.init();\n    },\n\n    init(){\n        //init coin\n        this.myCoin = this.storage.getMyCoin();\n        this.updateCoin(this.myCoin);\n\n        //broadCast\n        var broadcastNode = cc.find(\"main/boradbg\",this.node);\n        this.broadcastScript = broadcastNode.getComponent(\"broadcast\");\n\n        //msgList\n        var recarbg = cc.find(\"main/recarbg\",this.node); \n        this.listScript = recarbg.getComponent(\"ListViewCtrl\");\n        this.msgList = this.getComponent(\"msgList\");\n        var hisLsFSto = this.storage.getAllHis()\n        cc.log(\"hisLsFSto.length\",hisLsFSto.length)\n        for(var i = 0; i < hisLsFSto.length; ++i)\n        {\n            // cc.log(\"addNewRec.time = %s,addNewRec.item = %s\",hisLsFSto[i].time, hisLsFSto[i].item)\n            this.addNewRec(hisLsFSto[i].time, hisLsFSto[i].item);\n        }\n    },\n\n    updateCoin (val) {\n       this.coinLable.getComponent(cc.Label).string = val;\n       this.myCoin = val;\n       this.storage.setMyCoin(val);\n    },\n\n    addCoin(addVal)\n    {\n        this.myCoin += addVal;\n        this.updateCoin(this.myCoin);\n    },\n\n    cutCoin(cutVal)\n    {\n        this.myCoin -= cutVal;\n        this.updateCoin(this.myCoin);\n    },\n\n    circleRun (speed) {\n       if(!this.circle){ \n        cc.log(\"circle is null\");\n        return;\n        }\n        if (speed < 0 ){speed = 0}\n        if(speed == this.setp){return ;}\n        // cc.log(\"---------- circlerun -----------\")\n        speed = speed || 50;\n        this.speed = speed;\n        var cirecleNode = this.circle;\n        cirecleNode.stopAllActions();\n        var rotate = cc.rotateBy(this.setp/speed,-this.setp);\n        var callback = cc.callFunc(this.updateRotate, this);\n\n        var seq = cc.sequence(rotate,callback);\n        cirecleNode.runAction(cc.repeatForever(seq));\n        return;\n    },\n\n    createItem (tilp, num, id){\n        var item = cc.instantiate(this.itemTemplate)\n        item.x = 0\n        item.y = 0\n        item.getComponent(\"item\").updateItem(tilp,num,0)\n        return item\n    },\n\n    addNewRec(tilp, num){\n        var item = this.createItem(tilp,num,0);\n        this.listScript.pushToList(item);\n    },\n\n    cirecleStopToSetp (setp) {\n        var rotate = (setp - 1) * this.setp % 360;\n        var are = 51;\n        var curRotate = -this.circle.rotation % 360\n        // cc.log(\"curRotate = %s, rotate = %s\",curRotate, rotate)\n        if (Math.abs(curRotate - rotate) <= 3 )\n        {\n            var cirecleNode = this.circle;\n            cirecleNode.stopAllActions();\n            this.resetTimer1();\n            // var itemStr = this.msgList.hisList[this._youGetNum - 1 % this.msgList.hisList.length];\n            var itemStr = this.storage.getCurTime();\n\n            this.addNewRec(itemStr,this._youGetNum);\n            this.storage.addAHis(itemStr, this._youGetNum);//存储数据\n            var bIndex  = this.random(0,this.msgList.tilpList.length)\n            this.broadcastScript.baradcastMsg(this.msgList.tilpList[bIndex])\n            this.addCoin(this._youGetNum)\n            cc.log(\"-------- stoped all -------\")\n        }\n    },\n\n    updateRotate (target,data){\n        this.curRotate = (this.curRotate + this.setp) % 360\n        // cc.log(\"curRotate = %s, setp = %s\", this.curRotate, this.setp)\n    },\n\n    startRandom () {\n        var bIndex  = this.random(0,this.msgList.tilpList.length)\n        this.broadcastScript.baradcastMsg(this.msgList.tilpList[bIndex])\n        this._youGetNum  = this.random(1,7)\n        cc.log(\"you get num = %d\", this._youGetNum)\n        this.cutCoin(this.coinPay);\n        this.startTimer1()\n    },\n\n    startTimer1(time){\n        this.timer1 = time || 0;\n        this.unschedule(this.sch1s);\n        this.schedule(this.sch1s,1);\n        cc.log(\"----------- startTimer1 ----------\");\n    },\n\n    resetTimer1(time){\n        this.timer1 = time || 0;\n        this.unschedule(this.sch1s);\n        cc.log(\"-------- resetTimer1 ---------\");\n    },\n\n    sch1s (dt){\n        this.timer1 = this.timer1 + 1;\n        // cc.log(\"timer1 time = %s,speed = %d\", this.timer1, this.speed);\n        if (this.timer1 >= 4)\n        {\n            // cc.log(\"--------speed -- --------\")\n            this.circleRun(this.speed - this.timer1*10);\n        }\n        else\n        {\n            // cc.log(\"--------speed ++ --------\")\n            this.circleRun(this.timer1*5 * this.setp);\n        }\n    },\n    update (dt) {\n        if(this.timer1 <= 0){return;}\n        if (this.timer1 >= 4)\n        {\n            if ((this.speed - this.setp) <= 1)\n            {\n                // cc.log(\"------------ will be stop ---------\");\n                this.cirecleStopToSetp(this._youGetNum);\n            }\n        }\n    },\n    random (begin, end)\n    {\n       return Math.floor(Math.random()*(end - begin) + begin) ;\n    },\n});\n"]}