{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\listview/assets\\scripts\\listview\\ListViewCtrl.js"],"names":["cc","Class","extends","Component","properties","itemTemplate","default","type","Node","scrollView","ScrollView","spawnCount","totalCount","spacing","bufferZone","onLoad","content","items","initialize","updateTimer","updateInterval","lastContentPosY","height","i","item","instantiate","addChild","setPosition","push","getPositionInView","worldPos","parent","convertToWorldSpaceAR","position","viewPos","node","convertToNodeSpaceAR","update","dt","buffer","isDown","y","offset","length","setPositionY","getComponent","itemId","itemID","scrollEvent","sender","event","addItem","removeItem","error","scrollToFixedPosition","scrollToOffset","p"],"mappings":"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","file":"ListViewCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\listview","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemTemplate: { // item template to instantiate other items\n            default: null,\n            type: cc.Node\n        },\n        scrollView: {\n        \tdefault: null,\n        \ttype: cc.ScrollView\n        },\n        spawnCount: 0, // how many items we actually spawn\n        totalCount: 0, // how many items we need for the whole list\n        spacing: 0, // space between each item\n        bufferZone: 0, // when item is away from bufferZone, we relocate it\n    },\n\n    // use this for initialization\n    onLoad: function () {\n    \tthis.content = this.scrollView.content;\n        this.items = []; // array to store spawned items\n    \tthis.initialize();\n        this.updateTimer = 0;\n        this.updateInterval = 0.2;\n        this.lastContentPosY = 0; // use this variable to detect if we are scrolling up or down\n    },\n\n    initialize: function () {\n        this.content.height = this.totalCount * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n    \tfor (let i = 0; i < this.spawnCount; ++i) { // spawn items, we only need to do this once\n    \t\tlet item = cc.instantiate(this.itemTemplate);\n    \t\tthis.content.addChild(item);\n    \t\titem.setPosition(0, -item.height * (0.5 + i) - this.spacing * (i + 1));\n    \t\t// item.getComponent('Item').updateItem(i, i);\n            this.items.push(item);\n    \t}\n    },\n\n    getPositionInView: function (item) { // get item position in scrollview's node space\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\n        let viewPos = this.scrollView.node.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    },\n\n    update: function(dt) {\n        this.updateTimer += dt;\n        if (this.updateTimer < this.updateInterval) return; // we don't need to do the math every frame\n        this.updateTimer = 0;\n        let items = this.items;\n        let buffer = this.bufferZone;\n        let isDown = this.scrollView.content.y < this.lastContentPosY; // scrolling direction\n        let offset = (this.itemTemplate.height + this.spacing) * items.length;\n        for (let i = 0; i < items.length; ++i) {\n            let viewPos = this.getPositionInView(items[i]);\n            if (isDown) {\n                // if away from buffer zone and not reaching top of content\n                if (viewPos.y < -buffer && items[i].y + offset < 0) {\n                    items[i].setPositionY(items[i].y + offset );\n                    let item = items[i].getComponent('Item');\n                    let itemId = item.itemID - items.length; // update item id\n                    // item.updateItem(i, itemId);\n                }\n            } else {\n                // if away from buffer zone and not reaching bottom of content\n                if (viewPos.y > buffer && items[i].y - offset > -this.content.height) {\n                    items[i].setPositionY(items[i].y - offset );\n                    let item = items[i].getComponent('Item');\n                    let itemId = item.itemID + items.length;\n                    // item.updateItem(i, itemId);\n                }\n            }\n        }\n        // update lastContentPosY\n        this.lastContentPosY = this.scrollView.content.y;\n    },\n\n    scrollEvent: function(sender, event) {\n        switch(event) {\n            case 0: \n               \n               break;\n            case 1: \n               \n               break;\n            case 2: \n               \n               break;\n            case 3: \n                \n               break;\n            case 4: \n               \n               break;\n            case 5: \n               \n               break;\n            case 6: \n               \n               break;\n            case 7: \n               \n               break;\n            case 8: \n               \n               break;\n            case 9: \n               \n               break;\n        }\n    },\n\n    addItem: function() {\n        this.content.height = (this.totalCount + 1) * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.totalCount = this.totalCount + 1;\n    },\n\n    removeItem: function() {\n        if (this.totalCount - 1 < 30) {\n            cc.error(\"can't remove item less than 30!\");\n            return;\n        }\n\n        this.content.height = (this.totalCount - 1) * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.totalCount = this.totalCount - 1;\n    },\n\n    scrollToFixedPosition: function () {\n        this.scrollView.scrollToOffset(cc.p(0, 500), 2);\n    }\n});\n"]}